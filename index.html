<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOC TOC TOC - Integração por Código</title>
    <style>
        :root { --primary: #00796b; --child: #00bcd4; --bg: #f4f7f6; --alert: #d32f2f; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 500px; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin: 20px; text-align: center; }
        .tela { display: none; animation: fadeIn 0.3s; }
        .ativa { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        h2 { color: var(--primary); font-size: 1.1rem; text-transform: uppercase; margin-bottom: 15px; }
        .menu-inicial { display: grid; gap: 10px; margin-top: 20px; }
        
        input, select { width: 100%; padding: 12px; margin: 6px 0; border: 1px solid #ccc; border-radius: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        
        .btn-resp { background: var(--primary); color: white; }
        .btn-prof { background: #546e7a; color: white; }
        .btn-child { background: var(--child); color: white; border: 2px solid #fff; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .btn-card { border: 2px solid #eee; border-radius: 15px; padding: 10px; cursor: pointer; background: #fff; }
        .btn-card img { width: 70px; height: 70px; object-fit: contain; }
        .btn-card p { font-size: 10px; font-weight: bold; margin-top: 5px; color: #555; }
        
        .card-relatorio { background: #f9f9f9; padding: 15px; border-radius: 12px; border-left: 5px solid var(--primary); margin-bottom: 10px; text-align: left; font-size: 13px; }
        .tag-prof { background: #e0f2f1; color: var(--primary); padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        
        .footer { margin-top: 30px; font-size: 11px; color: #888; border-top: 1px solid #eee; padding-top: 15px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="menu" class="tela ativa">
        <h2 style="letter-spacing: 2px;">TOC TOC TOC</h2>
        <div class="menu-inicial">
            <button class="btn-resp" onclick="ir('cadastro_pai')">Cadastro Responsável</button>
            <button class="btn-prof" onclick="ir('cadastro_prof')">Cadastro Profissional</button>
            <button class="btn-resp" style="background:#ff9800" onclick="ir('login_pais')">Acesso dos Pais</button>
            <button class="btn-prof" style="background:#37474f" onclick="ir('login_prof')">Painel do Professor</button>
        </div>
    </div>

    <div id="cadastro_pai" class="tela">
        <h2>Novo Responsável</h2>
        <input type="text" id="p_nome" placeholder="Seu Nome">
        <input type="text" id="p_cpf" placeholder="Seu CPF">
        <input type="text" id="c_nome" placeholder="Nome da Criança">
        <input type="text" id="codigo_vinc" placeholder="Código da Turma ou Professor">
        <input type="password" id="p_senha" placeholder="Crie sua Senha">
        <button class="btn-resp" onclick="salvarPai()">Salvar e Vincular</button>
        <button onclick="ir('menu')">Voltar</button>
    </div>

    <div id="cadastro_prof" class="tela">
        <h2>Cadastro Profissional</h2>
        <input type="text" id="prof_nome" placeholder="Nome Completo">
        <input type="text" id="prof_id_vinc" placeholder="Código de Identificação da Turma">
        <input type="password" id="prof_senha" placeholder="Crie sua Senha">
        <button class="btn-prof" onclick="salvarProf()">Finalizar Cadastro</button>
        <button onclick="ir('menu')">Voltar</button>
    </div>

    <div id="login_pais" class="tela">
        <h2>Login Pais</h2>
        <input type="text" id="l_pai_cpf" placeholder="CPF">
        <input type="password" id="l_pai_senha" placeholder="Senha">
        <button class="btn-resp" onclick="logarPai()">Entrar</button>
        <button onclick="ir('menu')">Voltar</button>
    </div>

    <div id="painel_pais" class="tela">
        <h2 id="boas_vindas_pai">Olá</h2>
        <button class="btn-child" onclick="ir('humor_inicial')">ENTREGAR PARA CRIANÇA</button>
        <h3 style="font-size:14px; margin-top:20px;">Relatórios Integrados</h3>
        <div id="historico_integrado"></div>
        <button class="btn-resp" onclick="ir('menu')">Sair</button>
    </div>

    <div id="login_prof" class="tela">
        <h2>Login Professor</h2>
        <input type="text" id="l_prof_nome" placeholder="Seu Nome">
        <input type="password" id="l_prof_senha" placeholder="Senha">
        <button class="btn-prof" onclick="logarProf()">Entrar</button>
        <button onclick="ir('menu')">Voltar</button>
    </div>

    <div id="painel_prof" class="tela">
        <h2>Turma: <span id="id_turma_display"></span></h2>
        <div id="lista_alunos_vinculados"></div>
        <button class="btn-prof" onclick="ir('menu')" style="margin-top:20px;">Sair</button>
    </div>

    <div id="tela_obs_prof" class="tela">
        <h2 id="nome_aluno_obs">Observação</h2>
        <div style="text-align:left; font-size:12px;">
            <label>Dificuldade em manter conversa?</label>
            <select id="o_conversa"><option>Não</option><option>Sim</option></select>
            <label>Isolamento no recreio?</label>
            <select id="o_isolamento"><option>Não</option><option>Sim</option><option>Não sei</option></select>
            <label>Interesses restritos?</label>
            <select id="o_hiper"><option>Não</option><option>Sim</option><option>Não sei</option></select>
        </div>
        <button class="btn-prof" onclick="salvarObsTecnica()">Salvar Diário</button>
    </div>

    <div id="humor_inicial" class="tela">
        <h2>Como o Tatu está?</h2>
        <div class="grid">
            <div class="btn-card" onclick="setHumor('FELIZ')"><img src="tatu_feliz.png"><p>FELIZ</p></div>
            <div class="btn-card" onclick="setHumor('TRISTE')"><img src="tatu_triste.png"><p>TRISTE</p></div>
        </div>
    </div>
    <div id="motivo_triste" class="tela">
        <h2>O que houve?</h2>
        <div class="grid">
            <div class="btn-card" onclick="finalizarCriança('Castigo')"><img src="castigo.png"><p>Castigo</p></div>
            <div class="btn-card" onclick="finalizarCriança('Riram de mim')"><img src="grupo_bullying.png"><p>Riram</p></div>
        </div>
    </div>

    <div class="footer">
        Desenvolvido por <strong>MongBeach</strong><br>
        Instagram: <a href="https://instagram.com/mong.beach" style="color:var(--primary); text-decoration:none;">@mong.beach</a><br>
        WhatsApp: (13) 99175-3601
    </div>
</div>

<script>
    let userLogado = null;
    let alunoSelecionado = null;
    let relatoCriança = {};

    function ir(id) {
        document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
        document.getElementById(id).classList.add('ativa');
    }

    // CADASTROS
    function salvarPai() {
        let pais = JSON.parse(localStorage.getItem('tt_pais')) || [];
        let p = {
            nome: document.getElementById('p_nome').value,
            cpf: document.getElementById('p_cpf').value,
            crianca: document.getElementById('c_nome').value,
            codigoVinc: document.getElementById('codigo_vinc').value,
            senha: document.getElementById('p_senha').value
        };
        pais.push(p);
        localStorage.setItem('tt_pais', JSON.stringify(pais));
        alert("Cadastro e Vínculo realizados!"); ir('menu');
    }

    function salvarProf() {
        let profs = JSON.parse(localStorage.getItem('tt_profs')) || [];
        let pr = {
            nome: document.getElementById('prof_nome').value,
            codigoVinc: document.getElementById('prof_id_vinc').value,
            senha: document.getElementById('prof_senha').value
        };
        profs.push(pr);
        localStorage.setItem('tt_profs', JSON.stringify(profs));
        alert("Professor cadastrado com o código: " + pr.codigoVinc); ir('menu');
    }

    // LOGINS
    function logarPai() {
        let pais = JSON.parse(localStorage.getItem('tt_pais')) || [];
        userLogado = pais.find(x => x.cpf === document.getElementById('l_pai_cpf').value && x.senha === document.getElementById('l_pai_senha').value);
        if(userLogado) {
            document.getElementById('boas_vindas_pai').innerText = "Olá, " + userLogado.nome;
            ir('painel_pais');
            mostrarRelatorioIntegrado();
        } else alert("Dados incorretos.");
    }

    function logarProf() {
        let profs = JSON.parse(localStorage.getItem('tt_profs')) || [];
        userLogado = profs.find(x => x.nome === document.getElementById('l_prof_nome').value && x.senha === document.getElementById('l_prof_senha').value);
        if(userLogado) {
            document.getElementById('id_turma_display').innerText = userLogado.codigoVinc;
            ir('painel_prof');
            listarAlunos();
        } else alert("Professor não encontrado.");
    }

    // LÓGICA PROFESSOR
    function listarAlunos() {
        let pais = JSON.parse(localStorage.getItem('tt_pais')) || [];
        // Filtra alunos que usaram o MESMO código de vínculo do professor
        let meusAlunos = pais.filter(p => p.codigoVinc === userLogado.codigoVinc);
        let lista = document.getElementById('lista_alunos_vinculados');
        lista.innerHTML = meusAlunos.length ? meusAlunos.map(a => `
            <div style="background:#f0f0f0; padding:12px; margin:8px; border-radius:12px; text-align:left;">
                <strong>${a.crianca}</strong><br>
                <small>Responsável: ${a.nome}</small><br>
                <button onclick="abrirObs('${a.crianca}', '${a.cpf}')" style="background:var(--primary); color:white; padding:8px; margin-top:8px; font-size:11px;">Relatar Observação</button>
            </div>
        `).join('') : "<p>Nenhum aluno vinculado a este código ainda.</p>";
    }

    function abrirObs(nome, paiCpf) {
        alunoSelecionado = { nome: nome, paiCpf: paiCpf };
        document.getElementById('nome_aluno_obs').innerText = "Observando: " + nome;
        ir('tela_obs_prof');
    }

    function salvarObsTecnica() {
        let obs = JSON.parse(localStorage.getItem('tt_obs')) || [];
        obs.push({
            paiCpf: alunoSelecionado.paiCpf,
            aluno: alunoSelecionado.nome,
            prof: userLogado.nome,
            data: new Date().toLocaleString(),
            tipo: 'PROFISSIONAL',
            conversa: document.getElementById('o_conversa').value,
            isolamento: document.getElementById('o_isolamento').value
        });
        localStorage.setItem('tt_obs', JSON.stringify(obs));
        alert("Observação salva para os pais!"); ir('painel_prof');
    }

    // LÓGICA CRIANÇA
    function setHumor(h) { relatoCriança = { humor: h }; ir('motivo_triste'); }
    function finalizarCriança(o) {
        let obs = JSON.parse(localStorage.getItem('tt_obs')) || [];
        obs.push({
            paiCpf: userLogado.cpf,
            aluno: userLogado.crianca,
            data: new Date().toLocaleString(),
            tipo: 'CRIANÇA',
            humor: relatoCriança.humor,
            ocorrencia: o
        });
        localStorage.setItem('tt_obs', JSON.stringify(obs));
        alert("O Tatu guardou!"); ir('painel_pais');
        mostrarRelatorioIntegrado();
    }

    // RELATÓRIO PAI
    function mostrarRelatorioIntegrado() {
        let todas = JSON.parse(localStorage.getItem('tt_obs')) || [];
        let minhas = todas.filter(o => o.paiCpf === userLogado.cpf);
        document.getElementById('historico_integrado').innerHTML = minhas.reverse().map(o => `
            <div class="card-relatorio" style="border-left-color: ${o.tipo === 'CRIANÇA' ? 'var(--child)' : 'var(--primary)'}">
                <small>${o.data} - <strong>${o.tipo}</strong></small><br>
                ${o.tipo === 'CRIANÇA' ? `Humor: ${o.humor} | Relato: ${o.ocorrencia}` : 
                `<span class="tag-prof">Prof. ${o.prof}</span><br>Conversa: ${o.conversa} | Isolamento: ${o.isolamento}`}
            </div>
        `).join('');
    }
</script>
</body>
</html>
